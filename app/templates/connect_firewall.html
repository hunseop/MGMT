{% extends "base.html" %}

{% block content %}
<!-- 왼쪽 절반: 방화벽 연동 페이지 -->
<div class="col-md-6" style="margin: 10px 0;">
    <h2 class="mb-4">방화벽 연동 페이지</h2>
    <form>
        <div class="mb-3">
            <label for="vendor" class="form-label">Vendor 선택:</label>
            <select id="vendor" class="form-select">
                <option value="paloalto">Paloalto</option>
                <option value="secui">SECUI</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="model" class="form-label">Model 선택:</label>
            <select id="model" class="form-select"></select>
        </div>
        <div class="mb-3">
            <label for="ip" class="form-label">IP 입력:</label>
            <input type="text" id="ip" class="form-control">
        </div>
        <div class="mb-3" id="authInput"></div>
        <button type="button" class="btn btn-primary" onclick="submitForm()">저장</button>
    </form>
</div>

<!-- 오른쪽 절반: 연동된 장비 목록 페이지 -->
<div class="col-md-6" style="margin: 10px 0;">
    <h2 class="mb-4">Firewall 연동된 장비 목록</h2>
    <div class="mb-3">
        <input type="text" id="searchInput" class="form-control" placeholder="장비 검색...">
    </div>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">No</th>
                <th scope="col">Vendor</th>
                <th scope="col">Model</th>
                <th scope="col">IP</th>
                <th scope="col">Status</th>
            </tr>
        </thead>
        <tbody id="deviceList">
            <!-- 장비 목록이 여기에 동적으로 추가됩니다. -->
        </tbody>
    </table>
</div>


<script>
    // 장비 목록 데이터 (임시 데이터)
    const devices = [
        { vendor: "Paloalto", model: "PA-220", ip: "192.168.1.1", status: "연결됨" },
        { vendor: "SECUI", model: "MF2", ip: "192.168.1.2", status: "연결됨" },
        { vendor: "Paloalto", model: "PA-820", ip: "192.168.1.3", status: "연결 안됨" }
    ];

    // 페이지 로드 시 장비 목록 표시
    window.addEventListener("DOMContentLoaded", function() {
        renderDeviceList(devices);
    });

    // 장비 목록 표시 함수
    function renderDeviceList(devices) {
        const deviceList = document.getElementById("deviceList");
        deviceList.innerHTML = ""; // 목록 초기화

        devices.forEach(function(device, index) {
            const row = `
                <tr>
                    <th scope="row">${index + 1}</th>
                    <td>${device.vendor}</td>
                    <td>${device.model}</td>
                    <td>${device.ip}</td>
                    <td>${device.status}</td>
                </tr>
            `;
            deviceList.insertAdjacentHTML("beforeend", row);
        });
    }

    // 검색 기능 구현
    document.getElementById("searchInput").addEventListener("input", function() {
        const searchTerm = this.value.toLowerCase();
        const filteredDevices = devices.filter(function(device) {
            return (
                device.vendor.toLowerCase().includes(searchTerm) ||
                device.model.toLowerCase().includes(searchTerm) ||
                device.ip.toLowerCase().includes(searchTerm) ||
                device.status.toLowerCase().includes(searchTerm)
            );
        });
        renderDeviceList(filteredDevices);
    });

    // Vendor 선택 시 모델 옵션 변경
    document.getElementById("vendor").addEventListener("change", function() {
        const vendor = this.value;
        const modelSelect = document.getElementById("model");
        modelSelect.innerHTML = "";
        models[vendor].forEach(function(model) {
            const option = document.createElement("option");
            option.text = model;
            modelSelect.add(option);
        });
        updateAuthInput();
    });

    // 모델 선택 시 인증 정보 입력 필드 업데이트
    document.getElementById("model").addEventListener("change", function() {
        updateAuthInput();
    });

    // 인증 정보 입력 필드 업데이트 함수
    function updateAuthInput() {
        const vendor = document.getElementById("vendor").value;
        const model = document.getElementById("model").value;
        const authInput = document.getElementById("authInput");
        
        if (vendor === "paloalto") {
            authInput.innerHTML = `
                <label for="auth" class="form-label">API KEY 입력:</label>
                <input type="text" id="auth" class="form-control">
            `;
        } else if (vendor === "secui" && model === "MF2") {
            authInput.innerHTML = `
                <label for="auth" class="form-label">ID 입력:</label>
                <input type="text" id="auth" class="form-control">
                <label for="password" class="form-label mt-3">PW 입력:</label>
                <div class="input-group">
                    <input type="password" id="password" class="form-control">
                    <button class="btn btn-outline-secondary" type="button" id="passwordToggle" onclick="togglePasswordVisibility()"><i id="passwordIcon" class="bi bi-eye"></i></button>
                </div>
            `;
        } else if (vendor === "secui" && model === "NGF") {
            authInput.innerHTML = `
                <label for="auth" class="form-label">Client Key 입력:</label>
                <input type="text" id="auth" class="form-control">
                <label for="secret" class="form-label mt-3">Secret Key 입력:</label>
                <input type="text" id="secret" class="form-control">
            `;
        } else {
            authInput.innerHTML = ""; // 다른 조건에 해당하지 않으면 인증 정보 입력 필드를 비움
        }
    }

    // 패스워드 가시성 토글
    function togglePasswordVisibility() {
        const passwordInput = document.getElementById("password");
        const passwordIcon = document.getElementById("passwordIcon");
        
        if (passwordInput.type === "password") {
            passwordInput.type = "text";
            passwordIcon.classList.remove("bi-eye");
            passwordIcon.classList.add("bi-eye-slash");
        } else {
            passwordInput.type = "password";
            passwordIcon.classList.remove("bi-eye-slash");
            passwordIcon.classList.add("bi-eye");
        }
    }

    // 폼 제출
    function submitForm() {
        const vendor = document.getElementById("vendor").value;
        const model = document.getElementById("model").value;
        const ip = document.getElementById("ip").value;
        let auth;

        if (vendor === "paloalto") {
            auth = document.getElementById("auth").value;
        } else if (vendor === "secui" && model === "MF2") {
            const id = document.getElementById("auth").value;
            const pw = document.getElementById("password").value;
            auth = { id, pw };
        } else if (vendor === "secui" && model === "NGF") {
            const clientKey = document.getElementById("auth").value;
            const secretKey = document.getElementById("secret").value;
            auth = { clientKey, secretKey };
        }
        
        // 여기서는 임시로 alert로 정보를 출력하나, 나중에 이 정보를 데이터베이스에 저장할 수 있음.
        alert("Vendor: " + vendor + "\nModel: " + model + "\nIP: " + ip + "\n인증 정보: " + JSON.stringify(auth));
    }
</script>
<!-- Bootstrap Icons CDN -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.3"></script>
{% endblock %}